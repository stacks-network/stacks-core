[package]
name = "stacks-common"
version = "0.0.2"
authors = [
  "Jude Nelson <jude@stacks.org>",
  "Aaron Blankstein <aaron@blockstack.com>",
  "Ludo Galabru <ludovic@blockstack.com>",
]
license = "GPL-3.0-only"
homepage = "https://github.com/blockstack/stacks-blockchain"
repository = "https://github.com/blockstack/stacks-blockchain"
description = "Common modules for stackslib, libclarity"
keywords = ["stacks", "stx", "bitcoin", "crypto", "blockchain"]
readme = "README.md"
resolver = "2"
edition = "2021"
build = "build.rs"

[lib]
name = "stacks_common"
path = "./src/libcommon.rs"

[dependencies]
rand = { workspace = true, optional = true }
serde = { workspace = true , features = ["derive"] }
serde_derive = { workspace = true }
sha3 = { version = "0.10.1", default-features = false }
sha2 = "0.10"
ripemd = { version = "0.1.1", default-features = false }
lazy_static = { workspace = true }
percent-encoding = "2.1.0"
slog = { workspace = true, optional = true }
slog-term = { version = "2.6.0", default-features = false, optional = true }
slog-json = { version = "2.3.0", default-features = false, optional = true }
chrono = { version = "0.4.41", default-features = false, features = ["clock"] }
hashbrown = { workspace = true }
libsecp256k1 = { version = "0.5.0", optional = true }
getrandom = { version = "0.2", features = ["js"], optional = true}
curve25519-dalek = { version = "4.1.3", default-features = false, features = ["serde"], optional = true }
ed25519-dalek = { workspace = true, features = ["serde"], optional = true }
serde_json = { workspace = true }
rusqlite = { workspace = true, optional = true }

[target.'cfg(unix)'.dependencies]
nix = {version = "0.23", default-features = false, optional = true}

[target.'cfg(windows)'.dependencies]
winapi = { version = "0.3", features = [
  "consoleapi",
  "handleapi",
  "synchapi",
  "winbase",
], optional = true }

[target.'cfg(windows)'.dev-dependencies]
winapi = { version = "0.3", features = ["fileapi", "processenv", "winnt"] }

[dependencies.time]
version = "0.3.34"
features = ["std"]

[target.'cfg(not(target_family = "wasm"))'.dependencies]
secp256k1 = { version = "0.24.3", default-features = false, features = ["std","serde", "recovery"] }
rusqlite = { workspace = true, optional = true }

[target.'cfg(target_family = "wasm")'.dependencies]
libsecp256k1 = { version = "0.7.0", default-features = false, features = ["hmac"] }

[dev-dependencies]
rand_core = { workspace = true }
proptest = "1.6.0"

[target.'cfg(all(any(target_arch = "x86_64", target_arch = "x86", target_arch = "aarch64"), not(any(target_os="windows"))))'.dependencies]
sha2 = { version = "0.10", features = ["asm"] }

[target.'cfg(any(not(any(target_arch = "x86_64", target_arch = "x86", target_arch = "aarch64")), any(target_os="windows")))'.dependencies]
sha2 = { version = "0.10" }

[build-dependencies]
toml = { workspace = true }

[features]
default = ["log", "rusqlite", "vrf", "developer-mode", "ctrlc-handler", "rand"]
developer-mode = []
# Enables graceful shutdown handling for Ctrl+C (SIGINT) signals.
# This pulls in the `nix` or `winapi` dependency.
ctrlc-handler = ["dep:nix", "dep:winapi"]
slog_json = ["slog-json"]
rusqlite = ["dep:rusqlite", "rand"]
# Enables the rand module. This flag must be off on deterministic
# platforms such as CosmWasm
rand = ["dep:rand"]
serde = []
testing = ["rand"]
bech32_std = []
bech32_strict = []
log = ["slog", "slog-term", "slog-json"]
vrf = ["ed25519-dalek", "curve25519-dalek"]
wasm = ["developer-mode", "getrandom"]
# Wasm-specific features for easier configuration
wasm-web = ["rand", "getrandom/js", "libsecp256k1/static-context"]
wasm-deterministic = ["getrandom/custom"]
